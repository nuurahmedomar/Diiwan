<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <!-- Favicon icon -->
  <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/favicon.png" />
  <title>District Management</title>
  <link rel="stylesheet" href="../assets/extra-libs/datatables.net-bs4/css/dataTables.bootstrap4.css" />
  <link rel="stylesheet" href="../assets/extra-libs/datatables.net-bs4/css/responsive.dataTables.min.css" />
  <!-- Custom CSS -->
  <link href="../dist/css/style.min.css" rel="stylesheet" />
  <!-- Custom CSS -->
  <link href="../assets/extra-libs/c3/c3.min.css" rel="stylesheet" />
  <link href="../assets/libs/chartist/dist/chartist.min.css" rel="stylesheet" />
  <link href="../assets/extra-libs/jvector/jquery-jvectormap-2.0.2.css" rel="stylesheet" />
  <!-- Custom CSS -->
  <link href="../dist/css/style.min.css" rel="stylesheet" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

  <!-- CSS -->
  <link rel="stylesheet" href="../assets/extra-libs/datatables.net-bs4/css/dataTables.bootstrap4.css" />
  <link rel="stylesheet" href="../dist/css/style.min.css" />
</head>

<body>
  <!-- Preloader, Header, Sidebar -->
  <%- include('preloader') %>

    <!-- Main Content -->
    <div id="main-wrapper" data-theme="light" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
      data-sidebar-position="fixed" data-header-position="fixed" data-boxed-layout="full">
      <%- include('header') %> <%- include('sidebar') %>

          <div class="page-wrapper">
            <div class="page-breadcrumb">
              <div class="row">
                <div class="col-7 align-self-center">
                  <h4 class="page-title text-truncate text-dark font-weight-medium mb-1">
                    District Management
                  </h4>
                  <div class="d-flex align-items-center">
                    <nav aria-label="breadcrumb">
                      <ol class="breadcrumb m-0 p-0">
                        <li class="breadcrumb-item">
                          <a href="/index" class="text-muted">Home</a>
                        </li>
                        <li class="breadcrumb-item text-muted active" aria-current="page">
                          District
                        </li>
                      </ol>
                    </nav>
                  </div>
                </div>
                <div class="col-5 align-self-center">
                  <div class="customize-input float-end">
                    <select
                      class="custom-select custom-select-set form-control bg-white border-0 custom-shadow custom-radius">
                      <option selected>Aug 23</option>
                      <option value="1">July 23</option>
                      <option value="2">Jun 23</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <!-- 
            </div>
          </div>
        </div>

        Flash Messages
            <% if (success) { %>
              <div class="alert alert-success">
                <%= success %>
              </div>
              <% } %>
                <% if (error) { %>
                  <div class="alert alert-danger">
                    <%= error %>
                  </div>
                  <% } %>

                    <!-- District Table -->
                    <div class="container-fluid">
                      <div class="card">
                        <div class="card-body">
                          <h5 class="card-title">Districts</h5>
                          <button class="btn btn-primary mb-3" data-toggle="modal" data-target="#addDistrictModal">
                            Add District
                          </button>
                          <table id="districtTable" class="table table-striped table-bordered">
                            <thead>
                              <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Actions</th>
                              </tr>
                            </thead>
                            <tbody id="districtsBody">
                              <!-- Dynamic district data will be inserted here by JS -->
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
          </div>
    </div>

    <!-- Add District Modal -->
    <div id="addDistrictModal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New District</h5>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>
          <form id="addDistrictForm">
            <div class="modal-body">
              <div class="form-group">
                <label for="dis_name">District Name</label>
                <input type="text" name="dis_name" id="dis_name" class="form-control" required />
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">
                Add District
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit District Modal -->
    <div id="editDistrictModal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit District</h5>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>
          <form id="editDistrictForm">
            <div class="modal-body">
              <div class="form-group">
                <label for="edit_dis_name">District Name</label>
                <input type="text" name="dis_name" id="edit_dis_name" class="form-control" required />
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Delete District Modal -->
    <div id="deleteDistrictModal" class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Delete District</h5>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>
          <form id="deleteDistrictForm">
            <div class="modal-body">
              <p>Are you sure you want to delete this district?</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Cancel
              </button>
              <button type="submit" class="btn btn-danger">Delete</button>
            </div>
          </form>
        </div>
      </div>
    </div>
<!-- Load jQuery -->
<script src="../assets/libs/jquery/dist/jquery.min.js"></script>

<!-- Load Bootstrap and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="../assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- Load DataTables -->
<script src="../assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>

<!-- Load Custom Scripts -->
<script src="../dist/js/custom.js"></script>

<!-- District Management Script -->
<script>
  $(document).ready(function () {
    const districtTable = $("#districtTable").DataTable();

    // Fetch and display districts
    const fetchDistricts = async () => {
      const response = await fetch("/api/districts");
      const districts = await response.json();
      districts.forEach((district) => {
        districtTable.row.add([
          district.dis_id,
          district.dis_name,
          `<button class="btn btn-info btn-edit" data-id="${district._id}">Edit</button>
           <button class="btn btn-danger btn-delete" data-id="${district._id}">Delete</button>`,
        ]).draw();
      });
    };
    fetchDistricts();

    // Add district
    $("#addDistrictForm").on("submit", async (e) => {
      e.preventDefault();
      const dis_name = $("#dis_name").val();
      await fetch("/api/districts", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ dis_name }),
      });
      location.reload(); // Reload the page to fetch updated data
    });

    // Edit district
    $(document).on("click", ".btn-edit", async function () {
      const districtId = $(this).data("id");
      const response = await fetch(`/api/districts/${districtId}`);
      const district = await response.json();
      $("#edit_dis_name").val(district.dis_name);
      $("#editDistrictForm").data("id", district._id);
      $("#editDistrictModal").modal("show");
    });

    $("#editDistrictForm").on("submit", async (e) => {
      e.preventDefault();
      const districtId = $("#editDistrictForm").data("id");
      const dis_name = $("#edit_dis_name").val();
      await fetch(`/api/districts/${districtId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ dis_name }),
      });
      location.reload(); // Reload the page to fetch updated data
    });

    // Delete district
    $(document).on("click", ".btn-delete", function () {
      const districtId = $(this).data("id");
      $("#deleteDistrictForm").data("id", districtId);
      $("#deleteDistrictModal").modal("show");
    });

    $("#deleteDistrictForm").on("submit", async (e) => {
      e.preventDefault();
      const districtId = $("#deleteDistrictForm").data("id");
      await fetch(`/api/districts/${districtId}`, {
        method: "DELETE",
      });
      location.reload(); // Reload the page to fetch updated data
    });
  });
</script>

<!-- Include additional scripts if any -->
<%- include('scripts') %>


    
</body>

</html>